A finite state machine with callback for matrix keyboard